<!DOCTYPE html>
<html>
    <head>
        <title>Chat App</title>
        <style>
            body { font-family: sans-serif; max-width: 600px; margin: 20px auto; }
            .message-box { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; margin-bottom: 10px; }
            .input-group { margin-bottom: 10px; }
            input { padding: 8px; }
        </style>
    </head>
    <body>
        <h2>Real-time Chat with Names</h2>
        
        <div class="input-group">
            <input type="text" id="username" placeholder="Your Name" value="User 1"/>
        </div>

        <div class="message-box">
            <ul id="messages" style="list-style-type: none; padding: 0;"></ul>
        </div>

        <div class="input-group">
            <input type="text" id="messageInput" placeholder="Type a message..." style="width: 70%;"/>
            <button onclick="sendMessage()">Send</button>
        </div>

        <script>
            var ws = new WebSocket("ws://localhost:8000/ws");

            // පරණ මැසේජ් පූරණය කිරීම
            window.onload = async function() {
                const response = await fetch('http://localhost:8000/messages');
                const messages = await response.json();
                messages.forEach(msg => {
                    displayMessage(msg.username, msg.content);
                });
            };

            ws.onmessage = function(event) {
                var data = JSON.parse(event.data);
                displayMessage(data.username, data.content);
            };

            function sendMessage() {
                var input = document.getElementById("messageInput");
                var username = document.getElementById("username").value;
                
                // නමයි මැසේජ් එකයි දෙකම යවනවා
                var data = {
                    username: username,
                    content: input.value
                };
                
                ws.send(JSON.stringify(data));
                input.value = '';
            }

            function displayMessage(username, content) {
                var messages = document.getElementById('messages');
                var message = document.createElement('li');
                // නම තද අකුරින් පෙන්වමු
                message.innerHTML = `<strong>${username}:</strong> ${content}`;
                messages.appendChild(message);
                
                // අලුත් මැසේජ් එකක් ආවම පල්ලෙහාට ස්ක්‍රෝල් වෙන්න
                var box = document.querySelector('.message-box');
                box.scrollTop = box.scrollHeight;
            }
        </script>
    </body>
</html>